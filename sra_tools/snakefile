##reference https://stackoverflow.com/questions/44561183/multiple-inputs-and-outputs-in-a-single-rule-snakemake-file
import os

SRR_LIST = list()

def srr_list():
    srr_file = "SRR_Acc_List.txt"
    assert os.path.isdir(srr_file), f"{srr_file} is not found!"
    with open(srr_file)as fin:
        for line in fin:
            line = line.strip()
            SRR_LIST.append(line)

    return srr_file


rule all:
    input:
        expand("sra/{sra_id}_{read}.fastq.gz",sra_id=SRR_LIST, read=['1', '2'])


rule down_sra:
    output:
        os.path.join("sra","{sra_id}_1.fastq.gz")
    envmodules:
        "bbc/sratoolkit/sratoolkit-2.11.0",
    params:
        sra_id=srr_list
    threads: 4
    resources:
        nodes=1,
        mem_gb=8,
    shell:
        """
        fasterq-dump {params} --split-3  --progress
        """
